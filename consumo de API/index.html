<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja de Games</title>
</head>
<body>
    
<h1>Loja de Games</h1>
<br>
<h2>Lista de games/preços:</h2>
<ul id="list-games">

</ul>
<hr>
<h2>Novo Game:</h2>
<input type="text" name="titulo" id="ititulo" placeholder="Titulo"> <br>
<input type="number" name="ano" id="iano" placeholder="Ano"> <br>
<input type="number" name="price" id="iprice" placeholder="Price"> <br>
<button onclick="criarGame()">Criar</button>

</body>

<script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
<script>

//GET END-POINT VIEW GAMES
axios.get('http://localhost:4545/games')
    .then((response) =>{
        var gamesData = response.data
        var listGames = document.getElementById('list-games');

        gamesData.forEach((games) =>{
            //NEW ITEM
            var newItem = document.createElement('li');
            //Criando atributos customizáveis com setattribute()
            newItem.setAttribute('data-id', games.id);
            newItem.setAttribute('data-title', games.title);
            newItem.setAttribute('data-year', games.year);
            newItem.setAttribute('data-price', games.price)

            newItem.textContent = `${games.id}. ${games.title} - $${games.price}`
            listGames.appendChild(newItem);

            //DELETE BUTTON
            var deleteBtt = document.createElement('button');
            deleteBtt.innerHTML = 'Deletar';
            newItem.appendChild(deleteBtt);

            deleteBtt.addEventListener('click', () =>{
                var gameID = parseInt(newItem.getAttribute('data-id'))
                console.log(gameID);
                axios.delete(`http://localhost:4545/game/${gameID}`)
                    .then((res) =>{
                        if(res.status === 200){
                            window.alert('Game excluido');
                            window.location.reload();
                        }
                    })
                    .catch((error) =>{
                        console.log(error);
                    })
            })
        })

    })
    .catch((error) =>{
        console.log(error);
    })



//POST END-POINT CREATE A GAMES
    function criarGame(){
        var title = document.getElementById('ititulo').value;
        var year = parseInt(document.getElementById('iano').value);
        var price = parseFloat(document.getElementById('iprice').value);

        var newGame = {
            titleVar: title,
            yearVar: year,
            priceVar: price
        };

        axios.post('http://localhost:4545/game', newGame)
            .then((response) =>{
                if(response.status === 201){
                    alert('Game cadastrado');
                    window.location.reload();
                }
            })
            .catch((error) =>{
                console.log(error)
            })
    }


</script>
</html>